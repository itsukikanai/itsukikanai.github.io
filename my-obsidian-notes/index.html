<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opening Obsidian...</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #111; color: #eee; text-align: center; padding-top: 20vh; }
        a { color: #888; text-decoration: none; font-size: 0.9rem; }
        .btn { display: inline-block; padding: 10px 20px; background: #7b68ee; color: white; border-radius: 8px; text-decoration: none; margin-top: 20px; font-weight: bold;}
    </style>
    <script>
        window.onload = function() {
            // ---------------------------------------------------------
            // 設定: 自動判定を使う場合は true、手動で指定したい場合は false
            const autoDetectVaultName = true;
            let vaultName = "my-obsidian-notes"; // 手動の場合の予備
            // ---------------------------------------------------------

            // 1. URLからVault名を推測する (フォルダ構造: /VaultName/go/index.html を想定)
            if (autoDetectVaultName) {
                const pathSegments = window.location.pathname.split('/').filter(s => s !== "");
                // "go" の一つ前のフォルダ名をVault名として取得
                const goIndex = pathSegments.indexOf("go");
                if (goIndex > 0) {
                    vaultName = pathSegments[goIndex - 1];
                    // ※もしURLエンコードされた日本語フォルダならデコードする
                    vaultName = decodeURIComponent(vaultName);
                }
            }

            // 2. UUIDを取得
            const params = new URLSearchParams(window.location.search);
            const uid = params.get('uid');

            if (uid) {
                // 3. Obsidianを開く
                const targetURI = `obsidian://adv-uri?vault=${encodeURIComponent(vaultName)}&uid=${encodeURIComponent(uid)}`;
                window.location.href = targetURI;

                // 4. 画面表示
                document.getElementById('msg').innerText = `Opening "${vaultName}"...`;
                document.getElementById('manual-btn').href = targetURI;
            } else {
                document.getElementById('msg').innerText = "Error: No UID provided.";
            }
        }
    </script>
</head>
<body>
    <div id="container">
        <h2 id="msg">Preparing...</h2>
        <a id="manual-btn" class="btn" href="#">Open in Obsidian</a>
        <br><br><br>
        <a href="https://obsidian.md" target="_blank">Don't have Obsidian?</a>
    </div>
</body>
</html>
